---
import RedirectedLink from "../RedirectedLink.astro";
import { formatDate } from "../../scripts/util";

function makeTighter(str: string): string {
  return str.replace(/-/g, '\u2009');
}

function limitLength(str: string, maxLength: number): string {
  if (str.length <= maxLength) return str;
  const truncated = str.slice(0, maxLength).trimEnd();
  return truncated.slice(0, truncated.lastIndexOf(' ')) + 'â€¦';
}

const { tag, year, posts } = Astro.props;
---

<h2><a href=`/${tag}/${year}` class="text">{year}</a></h2>
<ol>
  {
    posts.map((post) => {
      const { dd, mmm } = formatDate(post.data.published);
      return (
        <li>
          <span>
            <RedirectedLink
              class = "text"
              href={`/${post.id}`}
              title={post.data.title}
              destination={post.data.redirect}
            >
              <span style="text-transform: lowercase;">{makeTighter(limitLength(post.data.title, 60))}</span>
            </RedirectedLink>
          </span>

          <div class="date">
            {mmm}<sup>{dd}</sup>
          </div>
        </li>
      );
    })
  }
</ol>