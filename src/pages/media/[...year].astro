---
import BaseLayout from "../../layouts/BaseLayout.astro";
import {
  getPosts,
  groupByTagAndYear,
  sortPostsDescending,
} from "../../scripts/posts";
import { Picture } from "astro:assets";

export const tag = "media";

export async function getStaticPaths() {
  const posts = (await getPosts()).filter((post) =>
    post.data.tags?.includes(tag)
  );

  const grouped = groupByTagAndYear(posts);
  const paths = [];

  for (const year in grouped[tag]) {
    const posts = grouped[tag][year];
    paths.push({
      params: { year },
      props: { posts },
    });
  }

  return paths;
}

const { year } = Astro.params;
let { posts } = Astro.props;

posts = posts && sortPostsDescending(posts);
---

<BaseLayout pageTitle={Astro.url.pathname}>
  <div class="container">
    <div class="title">
      <h1>{tag}</h1>
    </div>

    <div class="content list">
      <div class={tag}>
        {
          posts && (
            <ol>
              {posts.map((post) => {
                return (
                  <li>
                    <a href={`/${post.id}`}>
                      <Picture
                        src={post.data.cover}
                        alt={post.data.title}
                        title={post.data.title}
                      />
                    </a>
                  </li>
                );
              })}
            </ol>
          )
        }
      </div>
    </div>
  </div>
</BaseLayout>